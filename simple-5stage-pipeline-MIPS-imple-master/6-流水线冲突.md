HITwh NSCSCC Team | 哈尔滨工业大学（威海）全国大学生计算机系统能力培养大赛小组

[TOC]

# 6-流水线冲突

流水线中经常会有一些“相关”的问题发生，它使得指令序列中下一条指令没有办法按照设计的时钟周期执行，这些“相关”会降低流水线的性能，他们被称为流水线中的冒险（Hazard，书上译作冲突）。

流水线中冲突分为三种

1. 结构冲突；
2. 数据冲突；
3. 控制冲突。

## 结构冲突

指的是在指令的执行过程中，由于硬件资源满足不了指令执行的要求发生硬件资源冲突而产生的冲突。

比如指令和数据都共享一个存储器，在某个时钟周期的时候：

- 流水线要完成某条指令中，对存储器中数据的访问操作；
- 流水线同时还要完成下一条指令的取指操作。

这样就发生了存储器访问冲突，产生了结构冲突。

## 控制冲突

指的是流水线中的分支指令或者其他需要改写PC的指令造成的冲突。

## 数据冲突

**很常见的一种冲突类型**，指的是流水线中在执行的几条指令里面，有一条或者多条指令依赖于前面指令的执行结果。

数据冲突分为三种：

1. RAW：写后读数据，即后面的指令必须在前面的指令写之后读取数据，才能有正确结果；

2. WAR：读后写数据，即后面的指令必须在前面的指令读之后写入数据，才能有正确结果；

3. WAW：写后写数据，即后面的指令必须在前面的指令写之后写入数据，才能有正确结果；

### 对于本文档实现的简单CPU

从ORI指令的实现过程可以知道：

- ORI只有在流水线WB阶段才会写回寄存器，因此不存在WAW冲突；

而对于五级流水线的MIPS CPU来说：

- 因为只能在ID阶段读寄存器，WB阶段写寄存器，所以不存在WAR冲突

这样一看，问题简单了许多。